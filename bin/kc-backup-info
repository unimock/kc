#!/bin/bash

_help() {
  echo "usage: `basename $0` <domain>"
}

if [ "$1" = "" ] ; then
  _help
  exit 0
fi

DOM="$1"


echo "#"
echo "# "
echo "#"

unset imgs ; declare -A imgs
eval $( virsh domblklist $DOM --details | awk '/file +disk/ {print "imgs["$3"]="$4}' )
for dev in ${!imgs[@]}; do
  echo $dev : ${imgs[$dev]}
  qemu-img info -U ${imgs[$dev]}
done

echo "#"
echo "# libvirt chackpoint infos in /var/lib/libvirt/qemu/checkpoint/$DOM/:"
echo "#"
ls -la /var/lib/libvirt/qemu/checkpoint/$DOM/


echo "#"
echo "# virtnbdbackup checkpoint infos in /tsp0/sync/backup/$DOM/:"
echo "#"

ls -la /tsp0/sync/backup/$DOM/

echo "#"
echo "# libvirt chackpoint infos:"
echo "#"
vircpt -d $DOM list

echo "#"
echo "# virsh checkpoint-list for $DOM:"
echo "#"

virsh checkpoint-list $DOM
